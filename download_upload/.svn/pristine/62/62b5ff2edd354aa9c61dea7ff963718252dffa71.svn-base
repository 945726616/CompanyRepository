(function(h){function s(d){return i.DES.encrypt(i.enc.Hex.parse(d),i.enc.Hex.parse(p.hex(j)),{iv:i.enc.Hex.parse("0000000000000000"),padding:i.pad.NoPadding}).ciphertext.toString()}function k(d){return y.nid(++t,q,j,d,null,null,p,"hex")}function l(d,c,e,b){rpc.call({srv:"http://"+m+"/",to:"ccm/",type:d,data:c,ref:e,"static":!1,way:"json",qid:null==u?null:u,on_ack:b})}function v(d,c,e,b,a,f,w){c&&m!=c&&(m=c,j="");e&&e!=n&&(n=e);(a=a||b&&p.hex(b))&&a!=r&&(r=a);j="";var g=dh.gen_private(),c=dh.gen_public(g);
l("cacs_dh_req",{bnum_prime:dh.prime,root_num:dh.g,key_a2b:c,tid:x},f,function(a,c){var b=a?a.data:null;!b||b.result?w(a,c):(x=b.tid,q=b.lid,j=dh.gen_shared_secret(g,b.key_b2a),l(d,{lid:q,nid:k(2),user:n,pass:s(r),session_req:1,param:[{name:"spv",value:"v1"}]},f,function(a,c){var b=a?a.data:null;b&&""==b.result&&(t=b.seq);w(a,c)}))})}var m="",n="",r="",u="",x=0,q=0,t=0,j="",i=h.CryptoJS,p=h.md5_ex,y=h.codec;rpc=h.rpc;h.mcloud_account={pwd_encrypt:s,create_nid_ex:k,create_nid:function(){return k(0)},
sign_up:function(d,c,e,b,a,f){v("cacs_reg_req",d,c,e,b,a,f)},sign_in:function(d,c,e,b,a,f){v("cacs_login_req",d,c,e,b,a,f)},sign_out:function(){alert("plz do it")},send_msg:function(d,c,e,b){l(d,c,e,function(a,d){var e;var g=a&&a.data?a.data.ret||a.data.result:null;e=g?g.code||g.sub||g.reason:null;e&&"accounts.nid.invalid"==e||"accounts.sid.invalid"==e||"accounts.lid.invalid"==e?(c&&c.sess&&(c.sess.nid=k(0)),sign_in(m,n,null,l_pwd_md5,d,function(d,g,f){(e=a&&a.data?a.data.result:a)?b(a,f):l(d,c,f,
b)})):b(a,d)})}}})(window);
