function mme(a){this.create(a)}
mme.prototype={magic:"mme",langs:{en:{plz_select:"please select ",mic:"microphone",cam:"camera",and:"and ",set_done:"OK",installing:"Installing...",rebot_hint:"After Install, Restart Browser",install_mme:"Install Video Pluggin",try_flash:"Try Video with Flash",download:"Download and Install",l1:"More clear / high resolution video screen, a better full-screen display",l2:"Network intelligence to adapt, video connected to faster, more fluid video and audio effects",l3:"Safe and viruses, ease of use, reliable and professional organizations certified signatures",l4:"Permanent free",
l5:"System Requirements: Windows XP or later; browser: IE, Chrome, Firefox, Safari, Opera ..."},cn:{plz_select:"\u9009\u62e9",mic:"\u9ea6\u514b\u98ce",cam:"\u6444\u50cf\u5934",and:"\u548c",set_done:"\u786e\u5b9a",installing:"\u6b63\u5728\u5b89\u88c5...",rebot_hint:"\u5b89\u88c5\u5b8c\u6bd5\u540e\u91cd\u542f\u6d4f\u89c8\u5668",install_mme:"\u5b89\u88c5\u89c6\u9891\u52a0\u901f\u5668",try_flash:"\u6211\u5148\u8bd5\u8bd5\u666e\u901a\u89c6\u9891",download:"\u7acb\u5373\u5b89\u88c5\u89c6\u9891\u52a0\u901f\u5668",
l1:"\u66f4\u6e05\u6670/\u9ad8\u5206\u8fa8\u7387\u7684\u89c6\u9891\u753b\u9762\uff0c\u66f4\u597d\u7684\u5168\u5c4f\u663e\u793a\u6548\u679c",l2:"\u7f51\u7edc\u667a\u80fd\u9002\u5e94\uff0c\u89c6\u9891\u63a5\u901a\u66f4\u5feb\uff0c\u5f71\u97f3\u6548\u679c\u66f4\u6d41\u7545",l3:"\u5b89\u5168\u65e0\u75c5\u6bd2\uff0c\u653e\u5fc3\u4f7f\u7528\uff0c\u4e13\u4e1a\u673a\u6784\u8ba4\u8bc1\u7684\u53ef\u9760\u7b7e\u540d",l4:"\u6c38\u4e45\u514d\u8d39",l5:"\u7cfb\u7edf\u8981\u6c42\uff1aWindows XP \u6216\u66f4\u9ad8\u7248\u672c\uff1b\u6d4f\u89c8\u5668\uff1aIE,Chrome,Firefox,Safari,Opera..."}},
types:{install:{codebase:"MacIntel"==navigator.platform?"mme/npmme.pkg?0.160622.pkg":"mme/mme.exe?0.160622.exe"},activex:{name:"activex",xname:"MME.MMECtrl.1",clsid:"F3711E49-C6C3-4598-8888-8FD986250C98",codebase:"mme/mme_ie.cab",install_url:"",install_img:"",install_hint:""},xpcom:{name:"xpcom",mime:"application/mining-media-engine",codebase:"mme/npmme.xpi",install_url:"",install_img:"",install_hint:""},flash:{name:"flash",xname:"ShockwaveFlash.ShockwaveFlash",mime:"application/x-shockwave-flash",
clsid:"D27CDB6E-AE6D-11cf-96B8-444553540000",codebase:"",install_img:"",install_url:"http://www.adobe.com/go/getflashplayer",src:"/mme/mme.swf?0.130715.swf",install_hint:""}},debug:!0,windowless:0>(""+navigator.platform).indexOf("Linux"),id_allocer:{value:0},ver_min:0.160513,chl_status:{closed:0,initting:1,initting_device:2,running:3},plug_status:{closed:0,initting:1,installing:2,running:3},enable_native_plug:!0,enable_flash_plug:!0,get_default_skin:function(){return{dev_panel:{width:360,height:180}}},
create_plug:function(a,c,b,e){var f,g=null,g=this.id?this.id:++this.id_allocer.value,d=null,k=!!window.ActiveXObject||"ActiveXObject"in window;if(b&&(null==this.ver_cur||this.ver_cur>=this.ver_min))if(k&&"Win32"==navigator.platform)try{new ActiveXObject(this.types.activex.xname),d=this.types.activex}catch(i){}else null!=navigator.mimeTypes&&(0<navigator.mimeTypes.length&&null!=navigator.mimeTypes[this.types.xpcom.mime]&&navigator.mimeTypes[this.types.xpcom.mime].enabledPlugin)&&(d=this.types.xpcom);
if(!d&&c)if(k)try{new ActiveXObject(this.types.flash.xname),d=this.types.flash}catch(h){}else null!=navigator.mimeTypes&&(0<navigator.mimeTypes.length&&null!=navigator.mimeTypes[this.types.flash.mime]&&navigator.mimeTypes[this.types.flash.mime].enabledPlugin)&&(d=this.types.flash);if(d){this.type!=mme.prototype&&(this.type=d);e=e.replace(/'/g,'"');"Win32"==navigator.platform&&navigator.userAgent.toLowerCase().match(/chrome\/([\d.]+)/)&&(a.style.background="black");a.innerHTML="<object id='plug_"+
g+"' width='100%' height='100%'"+(k?" classid='clsid:"+d.clsid+"'":" type='"+d.mime+"'")+" codebase='"+d.codebase+"'"+(d==this.types.flash?" data='"+d.src+"'"+(this.windowless?" wmode='transparent'":""):"")+">"+(d==this.types.flash?" <param name='movie' value='"+d.src+"'/> <param name='allowScriptAccess' value='always'/> <param name='flashVars' value='mme_debug="+this.debug+"&mme_on_event=plug_"+this.id+"_on_event&mme_params="+encodeURIComponent(e)+"'/> <param name='allowFullScreen' value='true'/>"+
(this.windowless?" <param name='wmode' value='transparent'/>":"")+"   <a href='"+d.install_url+"'>        <img border='none' src='"+d.install_img+"' alt='"+d.install_hint+"'/>   </a>":" <param name='mme_on_event' value='plug_"+this.id+"_on_event'/>"+(this.windowless?" <param name='windowless' value='"+this.windowless+"'/>":"")+"<param name='mme_params' value='"+e+"'/>")+"</object>";if(g=k?window["plug_"+g]:document.getElementById("plug_"+g))try{if("flash"!=d.name&&(f=meval(g.ctrl(0,"query","{flag:65535}"))))if(mme.prototype.ver_cur=
f.version,f.version<this.ver_min)return a.innerHTML="",null}catch(n){}else a.innerHTML="";return g}return null},check_plug_install:function(a,c){var b,e,f,g=20,d=document.createElement("div"),k=!1;d.style.cssText="position:absolute;width:1px;height:1px;left:-1px;top:-1px;";document.body.appendChild(d);(b=this.create_plug(d,!1,!0,"{}"))?f=setInterval(function(){if(b&&"undefined"!=typeof b.ctrl||0>=--g){if(b&&"undefined"!=typeof b.ctrl)try{if(e=meval(b.ctrl(0,"query","{flag:65535}")))k=e.version>=mme.prototype.ver_min,
mme.prototype.plug_valid=k}catch(i){}clearInterval(f);d.innerHTML="";d.parentNode.removeChild(d);c(a,e?e.version:null)}},50):(d.innerHTML="",d.parentNode.removeChild(d),c(a,null==this.ver_cur?null:this.ver_cur))},clipboard_get_img:function(a){if(null==this.clipboard_plug&&(document.body.appendChild(mme.prototype.clipboard_cont=document.createElement("div")),mme.prototype.clipboard_cont.style.cssText="position:absolute;top:-1px;left:-1px;width:1px;height:1px;",mme.prototype.clipboard_plug=mme.prototype.create_plug(mme.prototype.clipboard_cont,
!1,!0,"{}"),null==mme.prototype.clipboard_plug||"undefined"==typeof mme.prototype.clipboard_plug.clipboard_get_img))mme.prototype.clipboard_plug=null,mme.prototype.clipboard_cont.innerHTML="",mme.prototype.clipboard_cont.parentNode.removeChild(mme.prototype.clipboard_cont),mme.prototype.clipboard_cont=void 0;return this.clipboard_plug?this.clipboard_plug.clipboard_get_img(a):null},clear_install:function(){this.install_timer&&(clearInterval(this.install_timer),delete this.install_timer);this.install_panel&&
(this.install_panel&&(this.install_panel.innerHTML="",this.install_panel.parentNode.removeChild(this.install_panel)),delete this.install_panel);this.install_test_panel&&(this.install_test_panel.parentNode&&(this.install_test_panel.innerHTML="",this.install_test_panel.parentNode.removeChild(this.install_test_panel)),delete this.install_test_panel)},install:function(){function a(b,a){var c=b.style;"cssFloat"in c?b.style.cssFloat=a:"styleFloat"in c&&(b.style.styleFloat=a)}var c,b=this,e=mme.prototype.types.install.codebase,
f="block",g=210,d=18,k="left",i="right",h=0,n,q="block",j,m,l,p;this.clear_install();this.parent.appendChild(this.install_panel=document.createElement("div"));j=this.install_panel;this.install_panel.style.cssText="position:absolute;left:0px;top:0px;width:100%;height:100%;background-color: black;color:#fff;line-height:2em;font-size:14px;visibility:hidden;";if(460>j.clientWidth||320>j.clientHeight)f="none";460>j.clientWidth&&(g=0.8*j.clientWidth,d=12,i=k="none",h=5);if(290>j.clientWidth||160>j.clientHeight)q=
"none";this.install_panel.innerHTML="<div style='position:absolute;left:4%;width:92%;overflow:none;'><center id='title_center' style='display:"+q+"'><span style='font-size:18px;'><b>"+this.lang.install_mme+"</b></span></center><br/><div id='install_description_div' style='display:"+f+"'><li>"+this.lang.l1+"</li><li>"+this.lang.l2+"</li><li>"+this.lang.l3+"</li><li>"+this.lang.l4+"</li><li>"+this.lang.l5+"</li><br/></div><a name='flash' href='#' style='float:"+k+";background:#333;font-size:"+d+"px;color:#fff;text-decoration:none;text-align:center;display:inline-block;width:"+
g+"px;height:auto;line-height:32px;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5Px;"+mhack.css_box_shadow(1,"#666666")+"' onmouseover='this.style.background=\"#666\";' onmouseout='this.style.background=\"#333\";' >"+this.lang.try_flash+"</a><a name='plug' href='"+e+"' target='_blank' style='float:"+i+";background:#333;font-size:"+d+"px;color:#fff;text-decoration:none;text-align:center;display:inline-block;width:"+g+"px;height:auto;margin-top:"+h+"px;line-height:32px;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5Px;"+
mhack.css_box_shadow(1,"#666666")+"' onmouseover='this.style.background=\"#666\";' onmouseout='this.style.background=\"#333\";'>"+this.lang.download+"</a><span name='plug_installing' style='display:none'></span></div><div style='float:clear;'></div>";document.body.appendChild(this.install_test_panel=document.createElement("div"));window.onresize=function(){n=document.getElementById("install_description_div");p=document.getElementById("title_center");m=dom_get_item_by_name(j,"*","flash");l=dom_get_item_by_name(j,
"*","plug");n&&(n.style.display=460>j.clientWidth||320>j.clientHeight?"none":"block");460>j.clientWidth?(m&&(m.style.width=0.8*j.clientWidth+"px",a(m,"none"),m.style.fontSize="12px"),l&&(l.style.width=0.8*j.clientWidth+"px",a(l,"none"),l.style.marginTop="5px",l.style.fontSize="12px")):(m&&(m.style.width="210px",a(m,"left"),m.style.fontSize="18px"),l&&(l.style.width="210px",a(l,"right"),l.style.marginTop="0px",l.style.fontSize="18px"));p&&(p.style.display=290>j.clientWidth&&160>j.clientHeight?"none":
"block")};if(this.on_event)this.on_event({type:"install_ui",panel:this.install_panel,download:e,ver_cur:this.ver_cur});this.install_panel.style.visibility="";this.install_test_panel.style.cssText="position:absolute;left:-1px;top:-1px;width:1px;height:1px;";(c=dom_get_item_by_name(this.install_panel,"*","flash"))&&mevt.bind(c,"click",function(){b.clear_install();b.status=b.plug_status.initting;if(null==(b.plug_obj=b.create_plug(b.parent,!0,!0,b.create_params))){if(b.status=b.plug_status.closed,b.on_event)b.on_event({type:"missing"})}else if(b.on_event)b.on_event({type:"create"});
return!1});(c=dom_get_item_by_name(this.install_panel,"*","plug"))&&mevt.bind(c,"click",function(){if(c=dom_get_item_by_name(b.install_panel,"*","plug_installing")){if(c.style.display="",c.innerHTML=b.lang.installing,c=dom_get_item_by_name(b.install_panel,"*","plug"))c.style.display="none"}else if(c=dom_get_item_by_name(b.install_panel,"*","plug"))c.innerHTML="<b>"+(mhack.ie||mhack.chrome?b.lang.installing:b.lang.rebot_hint)+"</b>";if(mhack.ie||mhack.chrome)b.install_timer=setInterval(function(){if(mme.prototype.create_plug(b.install_test_panel,
!1,!0,b.create_params))if(b.clear_install(),b.status=b.plug_status.initting,null==(b.plug_obj=b.create_plug(b.parent,!0,!0,b.create_params))){if(b.status=b.plug_status.closed,b.on_event)b.on_event({type:"missing"})}else if(b.on_event)b.on_event({type:"create"})},1E3)})},on_plug_event:function(a){a=meval(a);if(null==a)return 0;a.target&&(a.target.type&&a.target.url)&&(a.chl=this.chl_get(a.target.type,a.target.url));switch(a.type){case "is_ready":return null!=this.plug_obj;case "ready":this.status=
this.plug_status.running;break;case "close":a.chl&&(a.chl.status=this.chl_status.closed,a.chl.id=0)}if(this.is_created&&this.on_event)this.on_event(a);return 0},create:function(a){var c=a.parent,b=this;this.skin=this.get_default_skin();"object"==typeof a.skin&&obj_merge(this.skin,a.skin);this.parent=c;void 0!=a.debug&&(this.debug=a.debug);void 0!=a.windowless&&(this.windowless=a.windowless);void 0!=a.enable_native_plug&&(this.enable_native_plug=a.enable_native_plug);void 0!=a.enable_flash_plug&&(this.enable_flash_plug=
a.enable_flash_plug);this.on_event=a.on_event;this.mic_index=this.cam_index=-1;this.chls=[];this.create_params=a.params||"";this.ref_obj=a.ref_obj;this.is_created=!1;a.on_event&&(this.on_event_callback=a.on_event,this.on_event=function(a){a.plug=b;a.ref_obj=b.ref_obj;b.on_event_callback(a);a.plug=a.ref_obj=null});this.id=++this.id_allocer.value;window["plug_"+this.id+"_on_event"]=function(a){return b.on_plug_event(a)};this.status=this.plug_status.initting;if(null==(this.plug_obj=this.create_plug(c,
this.enable_flash_plug&&(!a.plug_install_mute||"Win32"!=navigator.platform&&"MacIntel"!=navigator.platform),this.enable_native_plug,this.create_params)))if(this.enable_native_plug&&!a.plug_install_mute&&("Win32"==navigator.platform||"MacIntel"==navigator.platform))if(this.ver_cur>=this.ver_min)if(b.status=b.plug_status.initting,null==(b.plug_obj=b.create_plug(c,!0,!0,b.create_params))){if(b.status=b.plug_status.closed,b.on_event)b.on_event({type:"missing"})}else{if(b.on_event)b.on_event({type:"create"})}else this.status=
this.plug_status.installing,this.install(function(){b.status=b.plug_status.initting;if(null==(b.plug_obj=b.create_plug(c,!0,!0,b.create_params))){if(b.status=b.plug_status.closed,b.on_event)b.on_event({type:"missing"})}else if(b.on_event)b.on_event({type:"create"})});else{if(b.status=b.plug_status.closed,b.on_event)b.on_event({type:"missing"})}else this.status==this.plug_status.running&&b.on_event&&setTimeout(function(){if(b.on_event)b.on_event({type:"ready"})},0);this.is_created=!0},destroy:function(){this.clear_install();
window["plug_"+this.id+"_on_event"]=null;for(var a,c=this.chls.length-1;0<=c;--c)(a=this.chls[c])&&this.chl_destroy(a);this.dev_form&&(this.dev_form.onsubmit=null,this.dev_form.innerHTML="",this.dev_form.parentNode.removeChild(this.dev_form),delete this.dev_form);this.plug_obj&&delete this.plug_obj;this.parent&&(this.parent.innerTHML="",delete this.parent);this.id&&delete this.id;this.status&&delete this.status;this.on_event&&delete this.on_event},update:function(){},is_ready:function(a){return this.plug_obj&&
this.status==this.plug_status.running&&(null==a||"undefined"!=typeof this.plug_obj[a])},select_device:function(a,c,b){var e,f,g,d,k=this,i=this.dev_form,h="";null==i&&(this.parent.appendChild(this.dev_from=i=document.createElement("form")),i.style.cssText="position:absolute;left:0px;top:0px;width:100%;height:100%;overflow-y:auto;overflow-x:none;padding:0px;margin:0px;background:transparent;background:#000;color:#fff;line-height:1.5em;font-size:12px;");i.style.visibility="hidden";i.innerHTML="";h+=
"<div style='position:absolute;left:5%;width:90%'><br/><center><span style='font-size:18x;'><b>"+this.lang.plz_select+this.lang.cam+this.lang.and+this.lang.mic+"</span></center>";if(a&&0<a.length){h+="<br/><span>"+this.lang.cam+"</span><br/>";for(f=0;f<a.length;f++)e=a[f],h+="<input type='radio' name='cam' id='cam_"+e.index+"' value='"+e.index+"' "+(0==f?"checked":"")+"/><label for='cam_"+e.index+"'>"+e.name+"</label><br/>"}if(c&&0<c.length){h+="<br/><span>"+this.lang.mic+"</span><br/>";for(f=0;f<
c.length;f++)e=c[f],h+="<input type='radio' name='mic' id='mic_"+e.index+"' value='"+e.index+"' "+(0==f?"checked":"")+"/><label for='mic_"+e.index+"'>"+e.name+"</label><br/>"}h+="<br/><center><input type='submit' value='"+this.lang.set_done+"' onmouseover='this.style.background=\"#666\";' onmouseout='this.style.background=\"#333\";' style='cursor:pointer;border:none;padding:0px;margin:0px;font-size:14px;color:#fff;width:120px;height:24px;-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3Px;"+
mhack.css_box_shadow(1,"#666666")+"line-height:32px;background:#333;'/></center></div>";i.innerHTML=h;if(this.on_event)this.on_event({type:"select_device_ui",form:i,mics:c,cams:a});i.style.visibility="";i.onsubmit=function(){f=0;for(d=i.getElementsByTagName("input");f<d.length;++f)if("radio"==(g=d[f]).type&&g.checked)"cam"==g.name?k.cam_index=g.value:"mic"==g.name&&(k.mic_index=g.value);i.style.display="none";b();return!1}},init_device:function(a){function c(){if(a.on_done)a.on_done()}if(null==this.plug_info&&
(this.plug_info=meval(this.plug_obj.ctrl(0,"query","{flag:65535}")))&&this.plug_info.camera){var b=[],e,f,g=this.plug_info.camera;for(e=0;e<g.length;++e)(f=g[e])&&0>f.name.indexOf("Google Camera Adapter")&&b.push(f);this.plug_info.camera=b}0>this.cam_index&&1==this.plug_info.camera.length&&(this.cam_index=this.plug_info.camera[0].index);0>this.mic_index&&1<=this.plug_info.microphone.length&&(this.mic_index=this.plug_info.microphone[0].index);0>this.cam_index&&1<this.plug_info.camera.length?this.select_device(this.plug_info.camera,
this.plug_info.microphone,c):c()},chl_get:function(a,c){for(var b=this.chls,e=b.length-1;0<=e;--e)if((chl=b[e])&&chl.type==a&&c==chl.url)return chl;return null},chl_destroy:function(a){for(var c=this.chls,b=c.length-1;0<=b;--b)if(a==c[b]){a.timer&&(clearTimeout(a.timer),a.timer=null);this.chl_status.initting_device==a.status&&(this.dev_from.style.display="none");a.status=this.chl_status.stopped;0<a.id&&(this.is_ready("chl_destroy")&&this.plug_obj.chl_destroy(a.id),a.id=0);a.refer=null;c.splice(b,
1);break}},chl_dev_index_param:function(a,c){return"\ncam.index="+a+"\nmic.index="+c},chl_create:function(a){return this.is_ready("chl_create")?(a={params:a.params||""},0>=(a.id=this.plug_obj.chl_create(a.params))?null:this.chls[this.chls.length]=a):null},ctrl:function(a,c,b){try{return this.is_ready("ctrl")?this.plug_obj.ctrl(a?a.id:0,c,b):'{type:"error",status:-1}'}catch(e){return'{type:"error",status:-1}'}}};mme.prototype.lang=window.lang_get?lang_get(mme.prototype.langs):mme.prototype.langs.cn;
