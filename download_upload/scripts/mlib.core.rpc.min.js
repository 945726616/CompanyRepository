(function(g,q,w,x){function l(){for(var a in h)h[a]&&k(h[a],"cancel")}function k(a,b){var e=a.js,c=a.seq,f=a.x;delete h[c];e&&(delete a.js,e.parentNode&&n.removeChild(e));f&&(delete a.x,f.abort());a.on_ack(b,a.ref);f&&(f.onreadystatechange=v,j[c]=f)}var h={},j={},r=Math.floor(1E6*Math.random()),v=function(){},n,s,y=function(a){try{return eval("("+a+")")}catch(b){return null}};s=setInterval(function(){var a,b,e=(new Date).getTime();for(a in h)(b=h[a])&&b.time<e&&k(b,"timeout")},5E3);w.bind(g,"unload",
function(){clearInterval(s);g.message=null;l();for(var a in j)j[a]&&delete j[a]});g.message=function(a){var b=h[a.to_handle];b&&k(b,a)};g.mrpc={magic:"rpc",call:function(a){if(a&&a.on_ack&&a.type){var b=!a["static"],e="json"!=a.way&&"get"!=a.method,c=a.from_handle,f=a.qid,p=b||e?"&":"-",l="-"==p?"-":"=",t=(a.srv?a.srv:"/")+(a.to?a.to:"")+"/"+a.type,c="hfrom_handle"+l+(null==c?++r:c)+(null==f?"":p+"hqid"+l+f)+p+x.obj_2_url(a.data,p),d={seq:r,on_ack:a.on_ack,time:(new Date).getTime()+(a.timeout?a.timeout:
3E5),url:e?t+".js":b?t+".js?"+c:t+"/-"+c+".js",param:e?c:"",ref:a.ref};if("test"!=a.way){h[r]=d;try{if("json"==a.way){var m=d.js=q.createElement("script");m.type="text/javascript";m.language="javascript";m.async=!0;m.src=d.url;(n||(n=q.getElementsByTagName("head")[0]||q.documentElement)).insertBefore(m,n.firstChild)}else{var u,i;for(u in j)if(i=j[u]){delete j[u];i.abort();break}i=i||(g.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"));i.open(d.param?"post":"get",d.url,!0);
i.onreadystatechange=function(){var a=i;if(d.x==a&&4==a.readyState){var b,e=d.seq;if(0==a.status)h[e]&&k(d,"abort");else{if(200==a.status||304==a.status){var c=a.responseText,f=c.indexOf("("),g=c.lastIndexOf(")");g>f+2&&("{"==c.charAt(f+1)&&"}"==c.charAt(g-1))&&(b=y(c.substring(f+1,g)))}d.x=null;k(d,b||"error");a.onreadystatechange=v;j[e]=a}}};d.param&&i.setRequestHeader("content-type","application/x-www-form-urlencoded;charset=utf-8");(d.x=i).send(d.param)}}catch(s){k(d,"error")}}return d.url}},
cancel:l}})(window,document,mevt,mcodec);
